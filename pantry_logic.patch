*** Begin Patch
*** Update File: pantry_logic.py
@@
-# If running inside Streamlit, please prefer st.secrets as a fallback for env var
-try:
-    import streamlit as _st
-    # only set env var when not already set
-    if not os.getenv("GOOGLE_API_KEY") and "GOOGLE_API_KEY" in _st.secrets:
-        os.environ["GOOGLE_API_KEY"] = _st.secrets["GOOGLE_API_KEY"]
-except Exception:
-    # not running in Streamlit or st.secrets not available; keep going
-    pass
+# If running inside Streamlit, prefer st.secrets as a fallback for env var
+try:
+    import streamlit as _st
+    # only set env var when not already set
+    if not os.getenv("GOOGLE_API_KEY") and "GOOGLE_API_KEY" in _st.secrets:
+        os.environ["GOOGLE_API_KEY"] = _st.secrets["GOOGLE_API_KEY"]
+except Exception:
+    # not running in Streamlit or st.secrets not available; keep going
+    pass
@@
-GOOGLE_API_KEY = os.getenv("GOOGLE_API_KEY")
-if not GOOGLE_API_KEY:
-    raise RuntimeError(
-        "GOOGLE_API_KEY is not set. "
-        "Set it as an environment variable before running the app."
-    )
-os.environ["GOOGLE_API_KEY"] = GOOGLE_API_KEY
+GOOGLE_API_KEY = os.getenv("GOOGLE_API_KEY")
+if not GOOGLE_API_KEY:
+    # Do not raise here so the app can render a friendly UI warning during debugging.
+    import warnings
+    warnings.warn(
+        "GOOGLE_API_KEY is not set. Model calls will fail. "
+        "Set GOOGLE_API_KEY in the environment or Streamlit secrets for full functionality."
+    )
+else:
+    os.environ["GOOGLE_API_KEY"] = GOOGLE_API_KEY
@@
-runner = Runner(
-    app=pantry_app,
-    session_service=DatabaseSessionService(
-        db_url="sqlite+aiosqlite:///./pantry.db",
-    ),
-)
+# ---------- DB URL (writable path, configurable) ----------
+# Use PANTRY_DB_URL env var (set in Streamlit secrets / host env). Fallback to /tmp/pantry.db
+DEFAULT_DB_PATH = "/tmp/pantry.db"
+db_url_env = os.getenv("PANTRY_DB_URL")
+if db_url_env:
+    DB_URL = db_url_env
+else:
+    # sqlite absolute path uses four slashes after sqlite+aiosqlite:
+    DB_URL = f"sqlite+aiosqlite:////{DEFAULT_DB_PATH.lstrip('/')}"
+
+# Ensure the file & parent dir exist with writable permissions (best-effort)
+if DB_URL.startswith("sqlite"):
+    try:
+        # Extract absolute path (after sqlite+aiosqlite:////)
+        path = DB_URL.split(":", 2)[-1].lstrip("/")
+        path = "/" + path  # absolute path
+        parent = os.path.dirname(path)
+        if parent and not os.path.exists(parent):
+            os.makedirs(parent, exist_ok=True)
+        # Create file if missing
+        if not os.path.exists(path):
+            open(path, "a").close()
+            try:
+                os.chmod(path, 0o666)  # readable/writable by all users (best-effort)
+            except Exception:
+                # some hosts don't allow chmod; ignore
+                pass
+    except Exception:
+        # fall back silently; host may restrict filesystem ops
+        pass
+
+runner = Runner(
+    app=pantry_app,
+    session_service=DatabaseSessionService(
+        db_url=DB_URL,
+    ),
+)
*** End Patch
